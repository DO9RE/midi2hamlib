if ! announce_rig_can get feature param ; then
  return 0
fi

# Announce parameter with or without value and store it for get_parameter.
announce_param() {
  last_parameter="${parameters[$1]}"
  if rig_can get parameter "${parameters[$1]}" ; then
    announce_rig_get_lp parameter "${parameters[$1]}"
  else
    echo "${parameters[$1]}"
  fi
  return 0
}

do_param_action() {
  if [[ "${param_menu[$1]}" == "$(t MENU_SET)" ]] ; then
    announce_rig_set_lp parameter "$last_parameter"
  else
    source "${funcdir}/params/get_parameter"
  fi
  return 0
}

# Announce parameter and build param menu.
select_param() {
  announce_param $1
  param_menu=( )
  if rig_can get parameter "${parameters[$1]}" ; then
    param_menu+=( "$(t MENU_GET)" )
  fi
  if rig_can set parameter "${parameters[$1]}" ; then
    param_menu+=( "$(t MENU_SET)" )
  fi
  show_menu "${parameters[$1]}" param_menu "$(t MSG_AND_NOW)" do_param_action
}

if [[ ! -v parameters ]]; then
  parameters=( ${rigcap_general[parameters_getonly]} ${rigcap_general[parameters_getset]} ${rigcap_general[parameters_setonly]} )
fi

if [[ $1 ]]; then #Triggered with parameter
  if validate_midi_value "$@" parameters param_midi_result; then
    announce_param "$param_midi_result"
  fi
else #Called from keyboard, show modes list and ask for selection.
  show_menu "$(t MSG_PARAMETERS)" parameters "$(t MSG_PARAMETER_PROMPT)" select_param
fi

